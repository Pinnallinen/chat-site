(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,n){e.exports=n(262)},108:function(e,t,n){},111:function(e,t,n){},262:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(16),r=n.n(o),i=(n(108),n(17)),l=n.n(i),c=n(28),u=n(19),m=n(20),d=n(22),h=n(21),p=n(23),g=(n(111),n(18)),f=n.n(g),b=n(15),k=n.n(b),v={en:{content:"Write something!",send:"Send"},fi:{content:"Kirjoita jotain!",send:"L\xe4het\xe4"}},C=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).handleChange=function(e){switch(e.target.name){case"content":n.setState({content:e.target.value})}},n.savePost=Object(c.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.props.loggedIn()){e.next=7;break}return e.next=3,fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.props.getToken())},body:JSON.stringify({content:n.state.content})});case 3:e.sent.status,e.next=8;break;case 7:n.props.history.replace("/");case 8:case"end":return e.stop()}},e)}));var a=v;return a="fi"===e.siteLang?a.fi:a.en,n.state={content:"",bundle:a},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(f.a,{name:"content",multiline:!0,rowsMax:"5",value:this.state.content,onChange:this.handleChange,label:this.state.bundle.content}),s.a.createElement(k.a,{onClick:this.savePost}," ",this.state.bundle.send," "))}}]),t}(a.Component),w=n(34),E=n(45),j=n.n(E),O=n(64),y=n.n(O),S=n(46),x=n.n(S),T=n(63),L=n.n(T),P=n(62),I=n.n(P),U={en:{createNewUser:"Create a new user",registerTitle:"Registering a new user",fieldsRequired:"Fields marked with * are required",username:"Username *",password:"Password *",password2:"Password again *",email:"Email *",fname:"First name *",lname:"Last name *",age:"Age *",phone:"Phone number",address:"Address",cancel:"Cancel",create:"Register user"},fi:{createNewUser:"Uusi k\xe4ytt\xe4j\xe4",registerTitle:"Uuden k\xe4ytt\xe4j\xe4n rekister\xf6inti",fieldsRequired:"* Merkityt kent\xe4t ovat pakollisia",username:"K\xe4ytt\xe4j\xe4nimi *",password:"Salasana *",password2:"Salasana uudestaan *",email:"S\xe4hk\xf6posti *",fname:"Etunimi *",lname:"Sukunimi *",age:"Age *",phone:"Phone number",address:"Address",cancel:"Peruuta",create:"Luo k\xe4ytt\xe4j\xe4"}},N=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).handleOpen=function(){n.setState({open:!0})},n.handleClose=function(){n.setState({open:!1})},n.handleChange=function(e){n.setState(Object(w.a)({},e.target.name,e.target.value))},n.submitUser=function(){var e=Object(c.a)(l.a.mark(function e(t){var a,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.state.pass!==n.state.pass2){e.next=11;break}return e.next=3,fetch("api/users/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pass:n.state.pass,email:n.state.email,username:n.state.username})});case 3:return a=e.sent,e.next=6,a.text();case 6:s=e.sent,console.log(s),201===a.status&&(n.handleClose(),n.props.registeredUser(a)),e.next=11;break;case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();var a=U;return a="fi"===e.siteLang?a.fi:a.en,n.state={bundle:a,open:!1,pass:"",pass2:"",username:"",email:""},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.state.bundle;return s.a.createElement("div",{class:"float-left"},s.a.createElement(k.a,{onClick:this.handleOpen,color:"primary"},e.createNewUser),s.a.createElement(j.a,{open:this.state.open,onClose:this.handleClose},s.a.createElement(I.a,null," ",e.registerTitle," "),s.a.createElement(x.a,null,s.a.createElement(L.a,null," ",e.fieldsRequired," "),s.a.createElement(f.a,{name:"username",label:e.username,value:this.state.username,onChange:this.handleChange}),s.a.createElement(f.a,{name:"pass",label:e.password,type:"password",value:this.state.pass,onChange:this.handleChange}),s.a.createElement(f.a,{name:"pass2",label:e.password2,type:"password",value:this.state.pass2,onChange:this.handleChange}),s.a.createElement(f.a,{name:"email",label:e.email,type:"email",value:this.state.email,onChange:this.handleChange})),s.a.createElement(y.a,null,s.a.createElement(k.a,{onClick:this.handleClose,color:"secondary"},e.cancel),s.a.createElement(k.a,{onClick:this.submitUser,color:"primary"},e.create))))}}]),t}(a.Component),J=n(97),A=n.n(J),F=n(99),R=n.n(F),W=n(98),_=n.n(W),q={en:{login:"Log in"},fi:{login:"Kirjaudu sis\xe4\xe4n"}},B=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).handleChange=function(e){e.target.name?n.setState(Object(w.a)({},e.target.name,e.target.value)):n.setState({expanded:!n.state.expanded})},n.handleLogin=function(){var e={};e.username=n.state.username,e.password=n.state.password,n.props.handleLogin(e)};var a=q;return a="fi"===e.siteLang?a.fi:a.en,n.state={expanded:!1,bundle:a},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(A.a,{expanded:this.state.expanded,onChange:this.handleChange},s.a.createElement(_.a,null,this.state.bundle.login),s.a.createElement(R.a,null,s.a.createElement(f.a,{name:"username",label:this.state.bundle.username,value:this.state.username,onChange:this.handleChange}),s.a.createElement(f.a,{name:"password",type:"password",label:this.state.bundle.password,value:this.state.password,onChange:this.handleChange}),s.a.createElement(k.a,{onClick:this.handleLogin},this.state.bundle.login))))}}]),t}(a.Component),K=n(100),M=n.n(K),z=n(102),D=n.n(z),$=n(101),G=n.n($),H=n(24),Q=n.n(H),V={en:{comment:"Say something!",postComment:"Send"},fi:{comment:"Kirjoita jotakin!",postComment:"L\xe4het\xe4"}},X=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).openPost=function(){n.setState({postOpen:!0})},n.handleClose=function(){n.setState({postOpen:!1})},n.handleComment=Object(c.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.props.loggedIn()){e.next=11;break}return console.log("/api/posts/".concat(n.props.post._id)),e.next=4,fetch("/api/posts/".concat(n.props.post._id),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.props.getToken())},body:JSON.stringify({content:n.state.comment})});case 4:if(200!==(t=e.sent).status){e.next=11;break}return e.next=8,t.json();case 8:a=e.sent,console.log(a.answers),n.setPostComments(a.answers);case 11:case"end":return e.stop()}},e)})),n.handleChange=function(e){n.setState(Object(w.a)({},e.target.name,e.target.value))};var a=V;return a="fi"===e.siteLang?a.fi:a.en,n.state={bundle:a,postOpen:!1,comment:"",postComments:null},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){this.setPostComments(this.props.post.answers)}},{key:"setPostComments",value:function(e){var t=e.map(function(e){return console.log(e),s.a.createElement("div",{class:"post"},s.a.createElement(Q.a,{color:"textSecondary",align:"right"},e.answer_owner),s.a.createElement(Q.a,{inline:!0,color:"textSecondary"},e.answer_date),s.a.createElement(Q.a,null,e.content))});console.log(t),this.setState({comment:"",postComments:t})}},{key:"render",value:function(){var e=this.props.post,t=this.state.bundle;return s.a.createElement("div",null,s.a.createElement(M.a,{onClick:this.openPost},s.a.createElement(G.a,null,s.a.createElement(Q.a,{color:"black",align:"right"},e.owner),s.a.createElement(Q.a,{color:"textPrimary"},e.content)),s.a.createElement(D.a,null)),this.state.postOpen?s.a.createElement("div",{id:"padding-0"},s.a.createElement(j.a,{open:this.state.postOpen,onClose:this.handleClose},s.a.createElement(x.a,null,s.a.createElement(Q.a,{align:"right",color:"textSecondary"},e.owner),s.a.createElement(Q.a,null,e.content),this.state.postComments,s.a.createElement(f.a,{name:"comment",label:t.comment,value:this.state.comment,onChange:this.handleChange}),s.a.createElement(k.a,{onClick:this.handleComment},t.postComment)))):s.a.createElement(s.a.Fragment,null))}}]),t}(a.Component),Y=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).getPosts=Object(c.a)(l.a.mark(function e(){var t,a,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("api/posts");case 2:if(200!==(t=e.sent).status){e.next=11;break}return e.next=6,t.json();case 6:a=e.sent,console.log(a),a&&(console.log(a),o=a.map(function(e){return console.log(e),s.a.createElement(X,{post:e,loggedIn:n.loggedIn,getToken:n.getToken})}),n.setState({posts:o})),e.next=11;break;case 11:case"end":return e.stop()}},e)})),n.setToken=function(e){localStorage.setItem("idToken",e)},n.getToken=function(){return localStorage.getItem("idToken")},n.removeToken=function(){localStorage.removeItem("idToken")},n.changeLang=function(){switch(n.state.siteLang){case"en":return n.setState({siteLang:"fi"});case"fi":default:return n.setState({siteLang:"en"})}},n.loggedIn=function(){return!n.isTokenExpired()},n.handleLogin=function(e){fetch("api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})}).then(function(e){200===e.status&&e.json().then(function(e){console.log(e),n.setToken(e.token),n.setState({state:n.state})})})},n.handleLogout=function(){n.removeToken(),n.setState({state:n.state})},n.registeredUser=function(e){n.setToken(e.token),n.props.history.replace("/")},n.decodeToken=function(e){var t=e.split(".")[1];if(t){var n=t.replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(n))}return null},n.isTokenExpired=function(){var e=n.getToken();return!e||n.decodeToken(e).exp<Date.now()/1e3},n.state={siteLang:"en",user:{},posts:[]},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){if(this.getPosts(),this.loggedIn()){var e=this.decodeToken(this.getToken()),t={};t.username=e.username,t.id=e.id,this.setState({user:t})}}},{key:"render",value:function(){return s.a.createElement("div",null,this.loggedIn()?s.a.createElement(s.a.Fragment,null,s.a.createElement(C,{siteLang:"en",loggedIn:this.loggedIn,getToken:this.getToken}),s.a.createElement(k.a,{onClick:this.handleLogout}," logout ")):s.a.createElement(s.a.Fragment,null,s.a.createElement(N,{siteLang:"en",registeredUser:this.registeredUser}),s.a.createElement(B,{siteLang:"en",handleLogin:this.handleLogin})),s.a.createElement("div",{class:"center"},this.state.posts))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[103,1,2]]]);
//# sourceMappingURL=main.325c3d12.chunk.js.map